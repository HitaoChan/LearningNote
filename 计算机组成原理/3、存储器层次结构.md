# 1、存储器的基本概念

## 1.1、存储器的分类

### 1.按存储介质分类

半导体存储器：随机存储器和只读存储器

磁表面存储器：磁盘、磁带

磁心存储器：目前被半导体取代，实质就是用导线外套磁环组成，控制电流的两种流向，形成两种磁场以便记录信息

光盘存储器：一般指光盘 

### 2.按存取方式分类

#### RAM随机存取存储器（Random Access Memory）

优点：读写方便，使用灵活

缺点：断电丢失信息

静态RAM常用作告诉缓冲存储器

动态RAM常用作主存

#### ROM只读存储器（Read-Only Memory）

断电后可以保留

ROM和RAM一起构成主存

包括：MROM（掩模型只读存储器）、PROM（可编程只读存储器）、EPROM（可擦除可编程存储器）、EEPROM（电可擦除可编程存储器）、Flash Memory（快擦除读写存储器）

ROM可以算是随机存取存储器，但是只能取不能存。

#### 串行访问存储器

需要按照物理位置的先后顺序依次访问，主要包括顺序存取存储器和直接存取存储器。

### 3.按在计算机的作用分类

主存

辅存

缓冲存储器

## 1.2、存储器的性能指标

存储容量

单位成本

存储速度

# 2、存储器的层次化结构

容量从大到小：磁带、光盘、磁盘、主存、缓存、寄存器

速度从慢到快：磁带、光盘、磁盘、主存、缓存、寄存器

价格从低到高：磁带、光盘、磁盘、主存、缓存、寄存器

主机：主存、缓存、寄存器

CPU:缓存、寄存器

辅存：磁带、光盘、磁盘

# 3、半导体随机存取存储器

## 3.1、半导体随机存取存储器的基本概念

### 1.半导体存储芯片的基本结构

### 2.半导体存储芯片的译码驱动方式

#### 片选法

![image-20200920021330580](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200920021330580.png)

#### 重合法

![image-20200920021347291](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200920021347291.png)

## 3.2、SRAM存储器

SRAM一般使用行列独立技术。


行列独立：同样的16bit存储器，这16个bit不是组织成一个矩阵，而是一个数组，标号0~15，所以需要四根地址线来寻找，譬如要找第12个bit，你发送地址线信号1100就能找到。可以发现行列独立的地址线数量比行列地址复用要多，但是地址数据只要一次就能传输完成。

## 3.3、DRAM存储器

### 1.DRAM的工作原理

DRAM一般使用行列地址复用技术。

行列地址复用：比如你的存储器容量是16bit，那么可以将这16个zhi比特组织成一个4*4的矩阵，为了找到某个你想要找的bit，比如第1行第2列的那个bit。你先发送二进制的01，表示要找的数据在第1行；接着发送二进制的10，表示要找的数据在第2列。这样一来你就找到了第1行第2列的那个bit。可以发现只要两根地址线就能寻找16个bit了，但是要发送两次地址（一次行地址，一次列地址）‍


### 2.DRAM存储器的刷新

## 3.4、只读存储器

## 3.5、FLASH存储器

# 4、主存储器与CPU的连接

如果要求将容量为a\*b的芯片组成容量为c\*d的芯片，假设需要芯片的数量为n

则n=(c\*d)/(a\*b)

## 1K*8位（位扩展）

a\*b的芯片

a是字线，连接的是地址线$log_2a$根地址线

b是数据线，b根数据线

![image-20200918213915739](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200918213915739.png)

## 2K*4位（字扩展）

![image-20200918213700296](image-20200918213700296.png)

## 字位扩充



# 5、双口RAM和多模块存储器

![image-20200919013038830](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919013038830.png)

## 单体多字存储器

特点：在一个存储周期内可以访问多个字，但若遇到转移指令，或者操作数不连续存放则效率提升不明显。

## 多体并行存储器

### 高位交叉编址（竖着访问）

优点：有利于存储器的扩充，只需将存储单元的编号往后加即可

缺点：由于各个模块一个接一个地串行工作，因此存储器的带宽受到限制

![image-20200919013443483](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919013443483.png)

![image-20200919014743158](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919014743158.png)

### 低位交叉编址（横着访问）

![image-20200919013556048](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919013556048.png)

![image-20200919015016973](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919015016973.png)

# 6、高速缓冲存储器

## 6.1、Cache的基本工作原理

### 局部性原理

时间局部性：被使用的数据或指令，将来可能再用

空间局部性：被使用的数据或指令，将来可能相邻

### 1.主存和Cache的编址

#### 主存

主存块号和块内地址

主存子块标记长度=主存地址长度-Cache地址长度

#### cache

缓存块号和块内地址

**命中率的概念**：CPU要访问的信息在Cache中的比例

命中率公式：$h=N_c/(N_c+N_m)$，$N_c$是命中cache的次数$N_m$是命中主存的次数

**平均访问时间的概念**：$t_a=ht_c+(1-h)t_m$，其中$t_c$表示访问cache的时间，$t_m$是表示访问主存的时间

**Cache-主存系统效率的概念**：$e=t_c/t_a$

### 2.Cache的基本结构



## 6.2、Cache和主存之间的映射方式

### 1.直接映射

i=j mod C

i为Cache中的块号，j为主存中的块号，C为Cache的块数

优点：实现简单

缺点：不够灵活；冲突概率高（抖动）

应用场合：大容量Cache

![image-20200919020449643](3%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.assets/image-20200919020449643.png)

### 2.全相联映射

优点：Cache的命中率可以提高；提高了Cache的利用率

缺点：tag的位数增加了，访问Cache时主存子块标记需要和Cache的全部标记进行比较，才能判断所访问主存地址是否已在Cache内。这种比较通常采用按内容寻址的相联存储器来完成。

应用场合：小容量Cache

### 3.组相联映射

组内有$2^r$块，cache和主存地址相差t位，则主存字块标记取t+r位

![image-20200919143428694](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919143428694.png)

### 例题

![image-20200919144138772](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919144138772.png)

![image-20200919144026997](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919144026997.png)

## 6.3、Cache中主存块的替换算法

直接映射无需考虑替换算法，直接替换

### 1.FIFO先进先出算法

### 2.近期少用算法LRU

### 3.随机法

## 6.4、Cache写操作策略

Cache是主存部分内容的副本，Cache应该和主存保持一致。

![image-20200919150122269](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919150122269.png)

### 1.写回法

需要设置一个修改位，修改位的0或1，决定该行内容是应该丢弃还是写回主存。

### 2.全写法

### 3.写一次法



# 7、虚拟存储器

## 7.1、虚拟存储器的基本概念

## 7.2、页式虚拟存储器

优点：由于页面的起点、终点地址是固定的，因此页表简单，调入方便，主存空间浪费小

缺点：由于页面不是逻辑上的独立实体，因此处理、保护和共享都不如段式虚拟存储器方便

![image-20200919161258934](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919161258934.png)

## 7.3、段式虚拟存储器

优点：段的分界与程序的自然分界相对应；段的逻辑独立性使他易于编译、管理、修改和保护，也便于多道程序共享；某些类型的段（堆栈、队列）具有动态可变长度，允许自由调度以便有效利用主存空间。

缺点：段的长度各不相同，段的起点和终点不固定，给主存空间分配带来麻烦，而且容易在段间留下许多空余的不易利用的零碎存储空间，造成浪费。

![image-20200919161856290](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919161856290.png)

## 页式和段式虚拟存储器的优缺点

![image-20200919162057973](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200919162057973.png)

## 7.4、段页式虚拟存储器

优点：兼备页式与段式虚拟存储器的优点

缺点：在地址映射中需要多次查表

## 7.5、TLB（快表）和慢表

在页式或短时虚拟存储器中，必须先查页表或段表，而在段页式虚拟存储器中，既查段表也查页表。为了加快查找速度，利用程序执行的过程中具有局部性的特点（类似Cache），将页表分为快表和慢表。

一般的页表称为**慢表**，放在主存中。

将当前最常用的页表信息放在一个小容量的告诉存储器中，称为快表。

如果快表命中，那么慢表就命中，该页面一定在内存中。

# 8、外存储器

## 1.硬盘存储器（重点）

问题1：硬盘存储器怎么记录数据的

1. 归零制（RZ）。记录1时，正向脉冲电流；记录0时，反向脉冲电流
2. 不归零制（NRZ）。记录1时，正向脉冲电流；记录0时，反向脉冲电流。见变就翻
3. “见1就翻”的不归零制（NRZ1）。只有记录1时，电流才改变方向

问题2：硬盘存储器的技术指标有哪些？

1. 记录密度
2. 存储容量：C=nks。C代表存储总容量；n为存放信息的盘面数；k为每个盘面的磁道数；s为每条磁道上记录的二进代码数。
3. 平均寻址时间
4. 数据传输速率
5. 误码率



![image-20200924193655028](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200924193655028.png)

平均等待时间：转一圈的时间*1/2

读一个扇区的时间=平均等待时间+寻道时间+磁盘读取时间+控制器延时

## 2.磁盘阵列（RAID）

RAID,是将多个独立的物理磁盘组成一个独立的逻辑盘，数据 在多个物理盘上交叉存储、并行访问，存储性能、可靠性和安全性都较高。

RAID有6个分级，其中RAID1〜RAID5无论何时有磁盘损坏，都 可以随时拔出损坏的磁盘再插入好的磁盘，而数据不会丢失。
RAIDO:无冗余，无校验的磁盘阵列；

RAID1:镜像磁盘阵列；

RAID2:含有可纠错的海明码校验；

RAID3：采用位交叉奇偶检验

RAID4：采用块交叉奇偶检验

RAID5：无独立检验的奇偶检验磁盘阵列

## 3.光盘存储器（了解即可）

存储密度高，成本低，容量大，携带方便，存储器长等；

CD-ROM：只读光盘；

CD-R：只可写入一次的光盘；

CD-RW：可读可写光盘，可以重复读写；

DVD-ROM：高容量的CD-ROM

# 9、错题

- CDROM是光盘，不是随机存取，ROM不是随机存取，不能取
- SDRAM在工作期间需要周期性刷新
- TLB根据存储内容来进行存取的，TLB又叫相联存储器
- 刷新是所有芯片的某行同时刷新，只看芯片存储序列的行号，不是一个一个芯片刷新。
- 存储器采用部分译码片选（高位一部分译码）时，会产生地址重叠
- 低位交叉编址冲突判断：**所在体数 = 序列号mod体数**如果一个序列中有相同的就冲突
- 采用指令Cache与数据Cache分离的主要目的是减少指令流水线资源冲突
- 全相联映射块冲突概率最小，直接映射块冲突概率最大。组相联映射居中
- Cache由硬件实现，和软件无关。
- 

