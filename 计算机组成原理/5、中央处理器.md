# 1、CPU的功能和基本结构

## 1.1、CPU的功能

- 指令控制：控制指令的执行，即完成取指令、分析指令、执行指令
- 操作控制：根据指令生成操作信号，并将其送入相应的部件，进而操作这些部件进行相应的动作
- 时间控制：对各种操作的发生加以时间上的控制
- 数据加工：对数据进行算术逻辑运算
- 中断处理：对计算机运行过程中的异常情况和特殊请求的处理

**CU和ALU的功能**

![image-20200921150940467](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921150940467.png)

## 1.2、CPU的基本结构

![image-20200921151026342](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921151026342.png)

## 1.3、CPU中的主要寄存器

- 通用寄存器：数量多，功能多，对用户可见，可以由程序编址；ACC，是一个通用寄存器
- 专用寄存器：
  1. PC
  2. IR
  3. MDR
  4. MAR
  5. PSWR状态标志寄存器

### 1.运算器中的寄存器

暂存寄存器

累加寄存器ACC

通用寄存器组

状态条件寄存器PSW

### 2.控制器中的寄存器

程序计数器PC

指令寄存器IR

存储器数据寄存器MDR

存储器地址寄存器MAR

---

# 2、指令执行过程

## 2.1、指令周期

![image-20200921152017676](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921152017676.png)

时钟周期：最基本的单位。

## 2.2、指令执行方案

### 1.单指令周期

所有指令都选用相同的执行时间来完成。

指令之间串行执行。

### 2.多指令周期

对不同类型的指令选用不同的执行步骤来完成，称为多指令周期方案。

指令之间串行执行。

### 3.流水线方案

指令之间可以并行执行的方案，称为流水线方案。

目标：力争在每个时钟脉冲周期完成一条指令的执行过程。

## 2.3、指令的执行过程与信息流

### 1.取指周期

![image-20200921154807982](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921154807982.png)

### 2.间址周期

![image-20200921155150955](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921155150955.png)

### 3.执行周期

不同指令执行周期操作不同，数据流多种多样，因此没有同意的数据流表示法

### 4.中断周期

![image-20200921155703630](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921155703630.png)

---

# 3、数据链路的功能和基本结构

## 1.数据通路的功能

实现CPU内部的运算器和寄存器，以及寄存器之间的数据交换。

## 2.数据通路的基本结构

### CPU内部总线方式

![image-20200921160952639](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921160952639.png)

### 专用数据通路方式

特点：性能比较高；硬件量比较大

![image-20200921163249313](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921163249313.png)

## 3.常见数据通路的数据传送

寄存器之间的数据传送

主存与CPU之间的数据传送

执行算数或逻辑运算

----

# 4、控制器的功能和工作原理

## 4.1、控制单元的功能

### 1.微操作命令的分析

### 2.控制单元的功能

**输入CU的内容如下：**

- 指令寄存器。将指令的操作码送入CU进行译码。
- 标志。
- 时钟。控制操作的时间
- 来自系统控制总线的控制信号。中断请求、DMA请求等信号的输入。

**CU输出的内容如下：**

- CPU内的控制信号。主要用于CPU内寄存器之间的传送和控制ALU实现不同的操作。
- 送至系统控制总线的信号。命令主存或者I/O读写、中断响应等输出信号。

### 3.控制信号举例

### 4.多级时序系统

### 5.控制方式

#### 同步控制方式

任何一条指令或指令中任何一个微操作的执行，都由事先确定且有唯一基准时标的时序信号所控制的方式叫做同步控制方式。

#### 异步控制方式

不存在基准时标信号，没有固定的周期节拍和严格的时钟同步，执行每条指令和每个操作需要多少时间就占用多少时间。

**用途：**主机与I/O设备间的传送控制，使高速的主机与慢速的I/O设备可以按照各自所需设置时序系统。

#### 联合控制方式（了解即可）

## 4.2、控制单元的设计

### 1.组合逻辑设计

![image-20200921181755955](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921181755955.png)

### 2.微程序设计

![image-20200921182307929](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200921182307929.png)

#### 微程序设计的概念

将一条机器指令编写成一个微程序，每一个微程序包含若干条微指令，每一条微指令对应一个或几个微操作指令。然后把这些微程序存到一个控制存储器中，用寻找用户程序的方法来寻找每个微程序中的微指令。所以逐条执行每一条微指令，也就相应的完成一条机器指令的全部操作。

#### 微程序控制的相关概念

**微命令与微操作**：一条机器指令可以分解成一个微操作序列，这些微操作是不可分的。在微程序控制的计算机中，将控制部件向执行部件发出的各种控制命令称为微命令，它是构成控制序列的最小单位。**微命令是微操作的控制信号，微操作是微命令的执行过程，**

**微指令与微周期**：微指令是若干微命令的集合。微周期指从控制存储器中读取一条微指令并执行相应的微操作所需的时间。

**主存储器与控制存储器**：主存储器用于存放程序和数据，在CPU外部，由RAM实现；控制存储器（CM，简称控存）用于存放微程序，在CPU内部，用ROM实现。

**程序与微程序**：程序是指令的有序集合，用于完成特定的功能；微程序是微指令的有序集合，一条指令的功能由一个微程序完成。

#### 微程序控制单元的基本组成

#### 微指令的基本格式

| 操作控制字段     | 顺序控制字段         |
| ---------------- | -------------------- |
| 发出各种控制信号 | 指出下地址，类似于PC |

#### 微指令的编码方式

- **直接编码方式**：

每一位都代表一个微命令，微命令的产生不需要译码。

优点：简单、直观、执行速度快，操作并行性好

缺点：微指令字过长，造成控制存储器过大

- **字段直接编码方式**

将微指令的操作控制字段分成若干**段**，将一组**互斥**的微操作命令放在一个字段内，通过对这个字段译码，便可以对应每一个微命令。

特点：缩短了微指令字长，增加了译码时间。

- **字段间接编码方式**

一个字段的某些微命令还需要由另外一个字段的某些微命令来解释，又称隐式编码。

- **混合编码方式**

把直接编码和字段编码（直接或间接）混合使用。

**注意**：不论哪种编码方式都要留出一个状态不发控制信号（微命令）

## 微指令地址的形成

![image-20200922003752691](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922003752691.png)

## 微指令序格式

1.水平型微指令

**一次能定义并执行多个并行操作**。如直接编码、字段直接编码、字段间接编码、直接和字段混合编码等。

2.垂直型微指令

**类似机器指令操作码**的方式。在微指令字中，设置微操作码字段，由微操作码规定微指令的功能。不强调其并行控制能力。

![image-20200922003903808](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922003903808.png)

## 两种微指令格式的比较

![image-20200922003941738](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922003941738.png)

----

# 5、指令流水线

## 5.1、指令流水线的基本概念

**特点：**

- 把一个任务（一条指令或者操作）分解成几个不同的子任务，每个子任务有专门的部件来完成，靠多个部件可并行工作来缩短指令执行的时间；
- 每个部件后边都有一个缓冲寄存器，叫锁存器，其作用是保存本流水段的结果，共给下一流水段用；
- 流水线中各子任务的完成耗时基本相同，否则将引起堵塞和断流；
- 只有连续不断的执行同一或者类似任务时流水线才能有较好的效率；
- 流水线有装入时间和排空时间，装入时间是第一个任务进入流水线到输出流水线的时间；排空时间是最后一个任务进入流水线到输出流水线的时间。

## 5.2、指令流水线的基本实现

### 1.资源相关（结构相关）

多条指令在同一时刻争用同一功能部件而形成的冲突称之为结构相关。

### 2.数据相关（重点）

多条指令因重叠操作，可能改变对操作数的读写访问顺序，从而导致了数据相关的冲突。

#### 写后读相关

#### 读后写相关

#### 写后写相关

### 3.控制相关

主要由转移指令引起。

## 流水线的性能指标

- 吞吐率：指令条数/时间
- 加速比:不使用流水线的时间/使用流水线的时间
- 流水线的效率：平行四边形面积/矩形面积

## 5.3、超标量和动态流水线的基本概念

![image-20200922010134050](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922010134050.png)

### 1.超标量技术

并发执行多条独立指令，需要配置多个功能部件。

### 2.超级流水线

将机器指令划分为更多级的操作，减轻每一级的复杂程度。三步分为五步：取指、译码、取操作数、执行、回写。

### 3.超长指令字

编译程序挖掘出指令潜在的并行性，将多条能并行操作的指令组成一条具有多个操作码字段的超长指令字。

### 4.动态流水线

多种运算可以同时运行，而金泰流水线只能是一宗运算进行完再进行下一种运算。

---

# 6、中断系统

----

# 7、错题

- 