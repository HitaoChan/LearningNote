# 1、I/O系统的基本概念

## 1.I/O系统的历史演变过程

四个阶段：

1. 早期阶段（程序查询方式）
2. **接口模块和DMA阶段（中断方式和DMA方式）**
3. 具有通道结构的阶段
4. 具有I/O处理器的阶段

## 2.I/O系统的基本概念

主要由两部分组成：I/O软件和I/O硬件

I/O软件：

- 主要功能：将用户编制的程序输入主机内，将运算结果输出给用户，实现输入/输出系统与主机工作的协调
- I/O指令的格式：操作码+命令码+设备码
- 通道指令：具有通道指令的计算机，一旦CPU执行了启动I/O设备的指令，就由通道来代替CPU对I/O设备的管理。

I/O硬件：

- 带接口的I/O系统中：接口模块+I/O设备
- 带通道的I/O系统中：通道（或称为处理器）；设备控制器和I/O设备等

---

# 2、外部设备

## 2.1、I/O设备分类

输入设备

输出设备

输入/输出兼备设备

## 2.2、输入设备

键盘、鼠标、触屏、麦克风、扫描仪、摄像头等。

## 2.3、输出设备

### 1.显示器

屏幕大小：以对角线长度表示

灰度级：显示的像素点亮暗差别

分辨率：显示器能显示的像素个数

刷新频率：

### 2.打印机

### 3.外存储器



---

# 3、I/O接口（I/O控制器）

## 3.1、I/O接口基础知识

I/O接口中的这些寄存器称为I/O端口。

## 3.2、I/O接口的基本功能和基本结构

### 1.I/O接口的功能

1. 选择设备功能
2. 传送命令功能
3. 传送数据功能
4. 反映I/O设备的工作状态

### 2.I/O接口的结构

![image-20200924012514994](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200924012514994.png)

其实中间红框内的部分就是对应到电路板上的插口，又分为内部接口和外部接口两种。

内部接口：与系统总线相连，实质上是与内存、CPU相连。数据的传输方式也只能是并行传输。

外部接口：通过接口电缆与外设相连，外部接口的数据传输可能是串行方式，因此I/O接口需具有串并转换功能。

### 3.I/O接口的类型

(1)按照数据传输方式:分为<u>并行和串行接口</u>；

(2)按照主机访问I/O设备的控制方式:可分为<u>程序查询接口、中断接口和DMA接口</u>；

(3按功能的灵活性可分为:<u>可编程接口和不可编程接口</u>。

## 3.3、I/O端口及编址

### 1.I/O端口

注意：接口和端口是不同的概念，端口是接口电路中的寄存器。

一个I/O接口可能有多个用户访问的寄存器，也就是多个I/O端口。

### 2.I/O端口的编址

I/O端口要能够被CPU访问，要有端口地址，一个端口对应一个端口地 址，端口编址方式有与存储器统一编址和独立编址两种：

(1)**统一编址**（存储器映射方式），是把丨/O端口当作存储器单 元进行地址分配；

优点：不需要专门的输入/输出指令，CPU访问I/O端口的操作灵活、方 便，端口编址空间大；

缺点：端口占用一部分存储器地址，使可访问的存储器的最大容量变小， CPU访问I/O端口的速度较慢。

(2)**独立编址**（I/O映射方式），I/O端口地址与存储器地址无 关，CPU靠专门的指令来访问端口。

优点：I/O端口地址不占用存储器地址；因为有独立的指令使CPU可以直接访问 端口，所以访问速度快；

缺点：需要设置专用指令。

---

# 4、I/O方式

## 4.1、程序查询方式

![image-20200923220102153](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923220102153.png)

特点：每时每刻不断查询I/O设备是否就绪

优点：较好协调主机与外设之间的时间差异，所用硬件少。

缺点：主机与外设只能串行工作，主机一个时间段只能与一个外设进行通讯，CPU效率低。

## 4.2、程序中断方式

计算机在程序执行过程中，当出现异常或者特殊情况时，计算机停止现 行程序的执行转向对这些异常情况或特殊情况的处理，处理结束后再返 回现行程序的间断处，继续执行原程序，这就是中断。

### **中断请求**

中断请求是指中断源向CPU发送中断请求信号。

- 内中断和外中断：
  外中断：来自CPU和内存以外的部件产生的中断，如I/O设备的中断；

  内中断：来自CPU和内存的中断，如除数为0等程序运算产生的错误 或者内存不足，空间分配失败产生的中断。

- 硬中断和软中断：
  硬中断：通过外部硬件产生的中断。硬中断属于外中断；

  软中断：通过指令产生的中断，可通过编程实现，软中断属于内中断

- 非屏蔽中断和屏蔽中断都属于外中断

### 中断判优

中断系统在某一时刻只能响应一个中断源的请求，但不同中断源发出请求 是随机的，因此可能某一时刻会同时产生多个中断请求，这时候要按照某 种规则来选择一个中断请求进行响应。

一般硬件故障属于最高级中断，其次是软件中断，非屏蔽中断高于可屏蔽 中断，DMA请求高于I/O设备，高速设备高于低速设备，输入设备高于输出 设备，实时设备高于普通设备。

### 中断响应和处理

响应条件：必须满足CPU中的允许中断触发器EINT为“T;该触发器可以 用开中断指令打开，可以用关中断指令或者由硬件自动关闭；

响应时间：CPU响应中断的时间是在每条指令执行阶段的结束时刻。

中断处理：

1.	保护现场
2.	中断服务
3.	恢复现场
4.	中断返回

## 4.3、DMA方式

主存和DMA接口之间有一条专用的数据通路，因此主存和设备交换信息时，不需要通过CPU，也不需要暂停CPU现行程序去为设备服务，使得I/O与主机并行工作，程序和数据传输并行工作，省去了保护现场和恢复现场的步骤，因此速度较快。

### 1.DMA方式特点

1. DMA使CPU与主存之间不存在固定联系，主存即可以被CPU访问，又可以被外设访问;
2. 在数据传输的时候，主存地址确定、传输数据的计数都由硬件电路直接实现；
3. 主存中要开辟专用缓冲区，以便随时供给和接收外设的数据
4. DMA使得CPU和外设并行，提高系统效率；
5. 
   DMA在开始前要通过程序进行预处理，结束后要通过中断方式进行后处理。


### 2.DMA的传送方法

#### 停止CPU访问主存法

![image-20200923232933436](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923232933436.png)

DMA请求信号迫使CPU让出总线控制权，停止访问主存，每次DMA获得总线控制权后连续占用若干 个存取周期进行数据传输，直到批量传输结束后才把总线控制权还给CPU。在DMA期间，CPU完全 停止访问主存，仅能进行一些与总线无关的内部操作。这种方式适用于高速外设。

#### DMA与CPU交替访问

![image-20200923233441323](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923233441323.png)

把原来的一个CPU工作周期分成两个时间片T1和T2分别给CPU和DMA,使CPU和DMA交 替访存，适用于CPU工作周期大于主存存取周期的情况。这种方法不存在总线的申请和 归还，总线使用权通过T4aT2分时控制，有较高的DMA传输效率。

#### 周期挪用

![image-20200923233556464](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923233556464.png)

这种方法中，每当I/O设备发出DMA请求的时候，DMA挪用总线一个存取周期，而DMA不 请求时，CPU仍继续访存。
在这种情况下，I/O设备请求DMA传输会遇到三种情况：

1. CPU在运算，没有访存，此时无冲突，DMA直接获取总线控制权；
2. CPU在访存，DMA必须等存取周期结束后才能获取总线控制权；
3. I/O设备要求数据传输的同时CPU也要求访存，此时I/O优先于CPU访存，I/O需要挪用一两 〒存取周期,b也就是CPU在执行访问主存的指令过程中插入了DMA请求，并挪用一两个存取周 使得CPU延缓了一两个存储周期才访存。

### 3.DMA接口的功能和组成

### 4.DMA小结

## 4.4、DMA和中断的区别

1. 中断方式是程序的切换，需要保护和恢复现场；而DMA方式除了预处理 和后处理，其他时候不占用CPU资源；
2. 中断请求的响应只能发生在每条指令的执行周期之后；而对DMA的响应 可以在取指周期、间址周期、执行周期之后均可以，只要CPU不占用总线就 可以被响应；
3. 中断传输过程需要CPU的干预，而DMA的传输过程不需要；
4. DMA请求的优先级高于中断请求优先级；
5. 中断功能多，比如可以处理异常，而DMA仅仅是为了I/O数据传输设计的；
6. 从数据传输来看，中断靠程序传输，DMA靠硬件传输；

---

# 5、错题