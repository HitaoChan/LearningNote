# 1、总线概述

![image-20200922202329010](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922202329010.png)

## 1.1、总线的基本概念

分时和共享是总线的两个特点。

**分时**：是指同一时刻只允许有一个部件向总线发送信息。

**共享**：是指总线上可以挂载多个部件，各个部件之间相互交换信息都可以通过这组线路分时共享。

相关名词：

1. 总线的传输周期。CPU通过总线对存储器或I/O端口进行一次访问所需的时间
2. 总线宽度。
3. 总线特性。例如：机械特性、电气特性、功能特性、时间特性。

## 1.2、总线的分类

- 按数据传送方式分类：并行传输总线和串行传输总线
- 按总线的适用范围分类：计算机总线、测控总线

按连接部件不同可以分类：片内总线、系统总线、通信总线。

### 片内总线

芯片内部的总线，如在CPU芯片内部，寄存器与寄存器之间，寄存器与算术逻辑单元（ALU）之间都是由片内总线连接的。

### 系统总线

数据总线：用来传送各功能部件之间的数据信息，它是双向传输总线。

地址总线：它是单向传输总线。主要用来指出数据总线上源数据或目的数据在主存单元的地址或I/O设备的地址。

控制总线：发出各种控制信号的传输线；局部单向，整体双向。

### 通信总线

用于计算机系统之间或计算机系统与其他系统之间的通信。

按照数据传输方式可分为：

1. 并行通信：适用于近距离的传输
2. 串行通信：适用于远距离的传输

## 1.3、总线的组成及性能指标

### 1.总线的组成

### 2.性能指标

#### 总线宽度

#### 总线带宽

#### 总线复用

#### 信号线数

![image-20200922215421708](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922215421708.png)

**例题**

![image-20200922220803333](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200922220803333.png)

## 1.4、总线的结构

### 1.单总线结构

优点：结构简单，成本低，设备接入简便

缺点：多个设备征用唯一的总线，造成数据传输带宽低，且不支持并发

### 2.双总线结构

优点：将低速设备和高速设备挂在不同的总线上，高速设备挂在存储器总线上，低速设备挂在I/O总线上，然后再通过**通道（专门用于输入输出操作的简单处理器）**与主存总线连接，以使得低速对高速设备的数据传输影响缩小。

缺点：通道访问主存需要经过主存总线，对高速设备还是有一定影响，通道的引入使得硬件设计更为复杂。

### 3.三总线结构

优点：DMA总线的引入使得部分高速I/O设备可以直接访问主存，是的传输速率进一步提高。

缺点：DMA控制器的引入使得硬件设计更为复杂。

---

# 2、总线仲裁

## 2.1、集中仲裁方式

### 1.链式查询方式

特点：只需要很少几根线就能按一定优先次序实现总线控制，容易扩充设备， 但对电路故障敏感，且优先级低的设备很难获得请求；

![image-20200923002105399](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923002105399.png)

### 2.计数器查询方式

特点：计数可以从0开始，此时一旦设备的优先次序被固定，设备的优先级就 按0,1,2,...，n的顺序降序排列，而且固定不变；计数也可以从上一次计数的终 止点开始，即是一种循环方法，此时设备使用总线的优先级相等；计数器的 初始值还可由程序设置，故优先次序可以改变。优先级设置较灵活，对故障 不敏感，连线及控制过程较复杂。

![image-20200923002220946](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923002220946.png)

### 3.独立请求方式

特点：响应速度快，优先级次序控制灵活，但控制数量多，总线控制更复杂。

三种方式所需控制线的条数分别为：链式查询两条，计数器定时查询约$log_2n$条，独立请求方式2n条

![image-20200923002255829](https://gitee.com/HaitoChan/upload-pic-typora/raw/master/null/image-20200923002255829.png)

## 2.2、分布仲裁方式

----

# 3、总线操作和定时

## 3.1、总线周期的概念

- 申请分配：主模块（主设备）提出申请，经过总线仲裁机构决定下一个传输周期给谁用
- 寻址：取得了使用权的主模块通过总线发送本次要访问的从模块地址及有关命令，启动参与本次传输的从模块。
- 传输：主从模块开始数据交换
- 结束：主模块相关信息撤出系统总线，让出使用权。

## 3.2、同步定时方式

系统采用统一的时钟信号来协调发送接收双方的传送定时关系。

优点：规定明确，统一性强，模块间的配合简单；传送速度快

缺点：同步通信必须按最慢的模块来设计公共时钟，当总线上的模块存取速度差别很大时，便会大大损失总线效率，并且不知道被访问的外部设备是否真正响应，故可靠性低。

## 3.3、异步定时方式

没有统一的时钟，没有固定的时间间隔。完全依靠双方相互制约的握手信号实现定时控制。开始传输之前主设备会向从设备发出请求，并且一直等从设备发来响应信号后才开始数据传输。

### 1.不互锁方式

主设备发出“请求”信号后，不必等到接到从设备的"回答”信号，而是经过一段时间便撤销"请求” 信号。而从设备在接到“请求”信号后，发出“回答”信号，并经过一段时间，自动撤销“回答”信 号，双方不存在互锁关系。

### 2.半互锁方式

主设备发出“请求”信号后，必须待接到从设备的"回答”信号后，才撤销"请求”信号，有互锁的关 系。而从设备在接到“请求”信号后，发出“回答”信号，但不必等待获知主设备的“请求”信号己经 撤销，而是隔一段时间后自动撤销“回答”信号，不存在互锁关系。

### 3.全互锁方式

（和三次握手一模一样）

主设备发出“请求”信号后，必须待从设备“回答”后，才撤销“请求”信号；从设备发出"回答”信 号，必须待获知主设备“请求”信号己撤销后，再撤销其“回答”信号。双方存在互锁关系。

---

# 4、总线标准

----

