# 1、网络层的功能

## 1.1、异构网络互连

> **中继系统：**
>
> 1. 物理层：中继器或集线器
> 2. 数据链路层：网桥或交换机
> 3. 网络层：路由器
> 4. 网络层以上：网关

## 1.2、 路由与转发

> **路由选择：**确定哪一条路径
>
> **分组转发：**当一个分组到达时所采用的动作

## 1.3、拥塞控制

> **拥塞：**计算机网络在一个子网或子网的一部分出现太多分组时，网络性能开始下降。
>
> 拥塞控制方法：
>
> 1. **开环控制**：	
>    1. 共性：决定时不考虑当前网络状态
>    2. 手段：确定何时可接受新流量、确定合适可丢弃分组及丢弃哪些分组、确定何种调度决策等。
> 2. **闭环控制**：
>    1. 措施：检测拥塞、报告拥塞和调整措施等
>    2. 代价：当提供的负载较小时，有拥塞控制的吞吐量反而比无拥塞控制时小



# 2、路由算法

## 2.1、静态路由与动态路由

> **静态路由**（非自适应路由选择）：
>
> 1. 特点：简单、开销小
> 2. 缺点：不能及时适应网络状态的变化
> 3. 范围：适用很小的网络
>
> **动态路由**（自适应路由选择）：
>
> 1. 特点：较好适应网络状态的变化
> 2. 缺点：实现复杂、开销大
> 3. 范围：适用较复杂的网络
> 4. 分类：**距离-向量路由算法**、**链路状态路由算法**

## 2.2、距离-向量路由算法

## 2.3、链路状态路由算法

> **特征**：
>
> 1. 向自治系统内的所有路由器发送信息
> 2. 发送的信息就是与本路由器相邻的所有路由器的链路状态，但只是部分信息
> 3. 只有链路状态发生变化时，路由器采用洪泛法向所有路由器发送信息

## 2.4、层次路由

> 原因：
>
> 1. 因特网的规模越来越大，路由表非常大处理起来太耗费时间，所有路由器交换路由信息所需的带宽就会使因特网的通信链路达到饱和
> 2. 许多单位不愿意外界了解自己单位网络的布局细节和本部门所采用的路由选择协议，但同时还是希望连接到因特网上
>
> 路由选择协议：
>
> 1. **内部网关协议IGP**：一个自治系统内部使用
>    1. **RIP**
>    2. **OSPF**
> 2. **外部网关协议**：自治系统之间使用
>    1. **BGP**



# 3、IPv4

## 3.1、IPv4分组

## 3.2、IPv4地址

> **保留地址**：本网络，网络地址全为0
>
> **该网络**:*主机号地址全为0*

|                  | A类地址0 | B类地址10 | C类地址110 |
| :--------------- | ------- | ------- | ------- |
| 最小网络地址     | 1 | 128.1 | 192.0.1 |
| 最大网络地址     | 126 | 191.255 | 223.255.255 |
| 不指派地址       | 0.0.0.0 | 128.0.0.0 | 192.0.0.0 |
| 可以指派的网络数 | $2^7-2 $ | $2^{14}-1$ | $2^{22}-1$ |
| 最大主机数       | $2^{24}-2$ | $2^{16}-2$ | $2^{8}-2$ |

> **直接广播地址**：*主机号全为1*。将一个分组发到一个特定网络上的所有主机。这个地址只能作为目的地址。
>
> **受限广播地址**：*255.255.255.255*。**定义**当前网络上的广播地址 
>
> **这个网络上的主机**：*0.0.0.0*
>
> **这个网络上的特定主机**：全0的网络号的IP地址
>
> **环回地址**：127.x.y.z。

## 3.3、NAT

> **专用地址**：
>
> ​	**10**.0.0.0~**10**.255.255.255（相当于一个A类网络）
>
> ​	**172.16.**0.0.~**172.31.**255.255（相当于16个连续的B类网络）
>
> ​	**192.168.0.**0~**192.168.255.**255(相当于256个连续的C类网络)

## 3.4、子网划分与子网掩码

> **划分子网的基本思路**：从主机号借若干个比特作为子网号
>
> 

## 3.5、CIDR

> **CIDR划分子块，子网号可以全0全1**
>
> **CIDR**表示： IP地址 ::= {<网络前缀>， <主机号>} / 网络前缀所占位数*斜线记法*
>
> **最长匹配**：找到最长的前缀

## 3.6、ARP

> 职责：动态的维护所在局域网上的各主机和路由器IP地址到硬件地址的映射表
>
> 作用：把IP地址直接转换成物理地址

## 3.7、DHCP

> 动态主机配置协议，提供即插即用连网的机制。
>
> **应用层协议**
>
> 使用**UDP**传输
>
> DHCP服务器给DHCP客户的IP地址是临时的
>
> **租用期**

## 3.8、ICMP

> **ICMP差错报告报文的分类**：
>
> 1. 终点不可达。路由器或主机不能交付
> 2. 源站抑制。因为拥塞丢弃
> 3. 时间超过。TTL为0
> 4. 参数问题。首部中有字段值不对
> 5. 改变路由（重定向）。
>
> **ICMP询问报文的分类**：
>
> 1. 有回送请求和回答报文
> 2. 时间戳请求和回答报文
> 3. 掩码地址请求和回答报文
> 4. 路由器请求和通告报文
>
> **不应发送ICMP差错报告报文的情况**
>
> 1. 对ICMP差错报告报文不再发送
> 2. 对第一个分片的数据报片的所有后续报片都不再发送
> 3. 对具有组播地址的数据报都不发送
> 4. 对具有特殊地址的（127.0.0.0或0.0.0.0）的数据包不发送
>
> **ICMP典型应用**
>
> 1. ping：应用层直接使用网络层ICMP的例子，没有通过**传输层**的TCP和UDP
> 2. tracert：跟踪分组经过的路由，工作在**网络层**



# 4、IPv6

## 4.1、IPv6的特点

> **主要特点**：
>
> 1. 更大的地址空间。128位，16B
> 2. 扩展到地址层次结构
> 3. 灵活的首部格式
> 4. 改进的选项
> 5. 允许协议继续扩充
> 6. 支持即插即用
> 7. 支持资源的预分配
> 8. 首部长度必须是**8B**的整数倍
>
> **IPv6相对IPv4的改进**：
>
> 1. 长的多的地址
> 2. 简化IP分组的基本首部。路由器能够更快地处理分组，从而改善吞吐率
> 3. 更好的支持选项。加快了分组处理速度

## 4.2、IPv6的格式

> 冒号十六进制
>
> 16位域有连续的0时，可以采用缩写法
>
> 双冒号在一个地址中只能使用一次



# 5、路由协议

## 5.1、路由选择协议分类

> 1. 内部网关协议IGP：一个自治系统内部使用。目前使用的最多，如RIP和OSPF
> 2. 外部网关协议EGP：不同自治系统，一个数据包传到另一个自治系统的边界时

## 5.2、RIP

> 只关心自己周围的世界，只与自己想零的路由器交换信息
>
> 范围：较小的自治系统
>
> **三要点**：
>
> 1. 仅和相邻路由器交换信息
> 2. 交换的信息是当前本路由器所知道的全部信息
> 3. 按固定的时间间隔交换路由信息
>
> 距离-向量算法
>
> **RIP的优点**：实现简单、开销小、收敛过程快
>
> **RIP格式**：
>
> ​	组成：首部、路由
>
> ​	RIP报文从应用层交付下来使用**传输层的**UDP传输，在**网络层**加上IP首部形成IP数据报进行传送
>
> **RIP的缺点**：
>
> 1. 限制了网络的规模
> 2. 交换的路由信息是路由器中的完整路由表，随着网络规模的扩大，开销就增加了
> 3. “坏消息传得慢”，使更新过程的收敛时间长

## 5.3、OSPF

> 范围：大型自治系统
>
> 链路状态协议
>
> **OSPF协议的三要点**：
>
> 1. 向本自治系统中所有路由器发送信息。洪泛法
> 2. 发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是部分信息
> 3. “链路状态”就是说明本路由器都和哪 些路由器相邻以及该链路的“度量”

## 5.4、RIP和OSPF的比较（P151

|                    | RIP              | OSPF           |
| ------------------ | ---------------- | -------------- |
| 协议参数           | 经过路由器的个数 | 费用（如时延） |
| 收敛速度           | 较慢             | 较快           |
| 分层               | 无               | 有             |
| 负载均衡           | 无               | 有             |
| 灵活性             | 无               | 有             |
| 以组播地址发送报文 | 无（广播         | 有（224.0.0.5  |

## 5.5、BGP

> **基本概念**：
>
> 1. 范围：不同自治系统之间交换路由信息的协议
> 2. 协议：路径-向量选择协议

## 5.6、RIP、OSPF、BGP最终陈述

| 主要特点     | RIP                                                      | OSPF                                                         | BGP                |
| ------------ | -------------------------------------------------------- | ------------------------------------------------------------ | ------------------ |
| 网关协议     | 内部                                                     | 内部                                                         | 外部               |
| 路由表内容   | 目的地址，下一跳，距离                                   | 目的网络，吓一跳，距离                                       | 目的网络，完整路径 |
| 最优通路依据 | 跳数                                                     | 费用                                                         | 多种有关策略       |
| 算法         | 距离-向量协议                                            | 链路状态协议                                                 | 路径-向量协议      |
| 传送方式     | 传输层UDP                                                | IP数据报                                                     | 建立TCP连接        |
| 其他         | 简单、效率低、跳数为16不可达；好消息传的快，坏消息传得慢 | 效率高、路由器频繁交换信息，难维持一致性；规模大、统一度量为可达性 |                    |



# 6、组播

## 6.1、组播的概念

> 范围：仅用于**UDP**
>
>  优点：明显地减轻网络中各种资源的消耗
>
> *组播需要路由器的支持*
>
> 组播路由器：能够运行组播协议的路由器

## 6.2、组播的地址

> *IP使用D类地址1110支持组播*
>
> 地址范围：224.0.0.0~239.255.255.255
>
> 重要的四点：
>
> 1. 组播地址只用于目的地址
> 2. 尽最大努力交付，不提供可靠交付
> 3. 不产生ICMP差错报文。ping组播地址永远不会有响应
> 4. 并非所有D类地址可以作为组播地址
>
> 两种组播：
>
> 1. 只在本局域网上进行硬件组播：简单，但是很重要。大部分主机都是通过局域网接入因特网的。
> 2. 在因特网的范围内组播：因特网组播的最后阶段还是要把组播数据在局域网用硬件组播交付给组播组的所有成员

## 6.3、组播地址与MAC地址的换算

> 只映射后23位地址
>
> 第二十四位取0
>
> 用十六进制表示
>
> 加上固定的首部



# 7、移动IP

## 7.1、移动IP的概念

> **概念**：移动IP技术可以使移动节点以固定的网络IP地址，实现跨越不同网段的漫游功能，并保证了基于网络IP的网络权限在漫游过程中不改变。
>
> **三大功能实体**：
>
> 1. 移动节点
> 2. 内部代理
> 3. 外部代理
>
> **需要技术**：
>
> 1. 代理搜索
> 2. 申请转交地址
> 3. 登录
> 4. 隧道
>
> **移动IP和动态IP区别**：
>
> 动态IP通过DHCP服务器动态的获得一个IP地址。

## 7.2、移动IP通信的过程



# 8、网络层设备

## 8.1、路由器的组成与功能

> 结构：
>
> 1. 路由选择部分：
>    1. 任务：根据所选定的路由选择协议构造出路由表
>    2. 核心部件：路由选择处理器
> 2. 分组转发部分：输入端口、交换结构、输出端口

## 8.2、路由表与路由转发 

> 路由表是根据路由选择算法得出，转发表是由路由表得出的。



# 9、错题

> **路由选择**：
>
> 1. 直接交付：同一个物理网段，不需要路由器
> 2. 间接交付：不同一个物理网段，需要路由器。设计直接交付
>
> **存储转发机制**：先接受整个分组；对分组进行错误检查，错误丢弃，否则存储；最后根据路由选择协议将正确的分组转发到合适的端口。
>
> **分层路由**：
>
> 1. 路由器被划分为区域
> 2. 每个路由器知道如何将分组路由到自己所在区域内的目标地址，但是对于其他区域内部不知情
> 3. 不同的网络连起来，可以将每一个网络当作一个独立的区域，好处是不其中一个网络中的路由器必知道其他网络的拓扑结构
>
> **动态路由和静态路由的主要区别**：动态路由选择需要使用路由选择协议取发现和维护路由信息，而静态路由选择只需要手动配置路由信息
>
> **CIDR的作用**：把小的网络汇聚成一个超网
>
> *IPv6不允许分片*
>
> *目前BGP支持CIDR *

