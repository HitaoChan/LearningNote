# 1、传输层提供的服务

## 1.1、传输层的功能

> 传输层属于面向通信部分的最高层，同时也是用户功能的最底层
>
> 传输层为两台主机提供了应用进程之间的通信，又称为**端到端通信**
>
> **传输层的功能**：
>
> 1. 提供应用进程之间的逻辑通信（网络层提供主机之间的逻辑通信）
> 2. 差错检测
> 3. 提供无连接或面向连接的服务
> 4. 复用或分用
>
> **面向连接服务的功能**：
>
> 1. 连接管路
> 2. 流量控制和拥塞控制



<center><b>TCP和IP的比较</b></center></br>

| TCP          | IP           |
| ------------ | ------------ |
| 面向连接服务 | 无连接服务   |
| 字节流接口   | IP数据报接口 |
| 有流量控制   | 无流量控制   |
| 有拥塞控制   | 无拥塞控制   |
| 保证可靠性   | 不保证可靠性 |
| 无丢失       | 可能丢失     |
| 不重复       | 可能重复     |
| 按序交付     | 可能失序     |

## 1.2、传输层寻址与端口

> **端口的基本概念**：
>
> ​	数据链路层按照MAC寻址，网络层按照IP寻址，传输层是按**端口号**寻址。
>
> ​	端口就是传输层服务访问点，就是用来标识应用层的进程。
>
> **端口号**：
>
> ​	标识不同进程。
>
> ​	分类：
>
> 		1. 熟知端口号（保留端口）：数值一般为0~1023
>   		2. 登记端口：数值一般为1024~49151
>     		3. 客户端端口或短暂端口：数值为49152~65535
>
> **套接字**：（主机IP地址，端口号）。*唯一的标识了网络中的某台主机上的某个进程*

## 1.3、 无连接服务与面向连接服务

> **UDP的主要特点**：
>
> 1. 传送数据前无需建立连接，数据到达后也无需确认
> 2. 不可靠交付
> 3. 报文头部短，传输开销小，时延较短
>
> **TCP的主要特点**：
>
> 1. 面向连接，不提供广播或多播服务
> 2. 可靠交付
> 3. 报文段头部长，传输开销大
>
> **TCP连接和网络层的虚电路的区别**：TCP中所谓的连接时在TCP的TCB中存储了对端地址的信息，并没有一条真正的物理连接。而电路交换是一条真正的物理连接。虚电路也不是一条真正的物理连接



# 2、UDP

## 2.1、UDP数据报

> **UDP的基本概念**：无连接的。UDP其实只是在IP的数据包服务之上加上了端口的功能（为了能找到进程）和差错检测的功能。
>
> **优点**：
>
> 1. 发送数据前不需要连接
> 2. UDP的主机不需要维持负责的连接状态表
> 3. UDP用户数据报只有八个字节的首部开销
> 4. 网络出现的拥塞不会使源主机的发送速率降低。对实时应用很重要
> 5. UDP支持一对一、一对多、多对一和多对多的交互通信
>
> **UDP数据报组成**：数据字段和首部字段。首部有8B
>
> ​    1.   源端口 2B
>
>  	2. 目的端口 2B
>  	3. 长度 2B
>  	4. 检验和 2B

## 2.2、UDP校验

> 只提供差错检测。在计算检验和时，要在UDP用户数据报之前临时加上12B的**伪首部**
>
> 伪首部只用于计算和验证检验和，不向下传送也不向上递交。
>
> **二进制反码计算**：反码相加，溢出末尾加一。<u>无差错时结果应该为全1</u>



# 3、TCP

## 3.1、TCP报文段

> 1. 源端口和目的端口：各2B
> 2. 序号：4B。TCP是字节流，所以需要序号
> 3. 确认号：4B。若为N，代表N-1为止的都收到
> 4. 数据偏移：4bit
> 5. 保留字段：6bit
> 6. 紧急URG：URG=1，应该尽快传送，不进入接受缓存
> 7. **确认比特ACK**：ACK=1，确认号才有效
> 8. 推送比特PSH：不用等到缓存满再交付
> 9. 复位比特RST：RST=1，说明出现严重差错，必须释放连接重新连接
> 10. **同步比特SYN**：SYN=1，说明请求连接
> 11. **终止比特FIN**：FIN=1，说明发送结束，要求释放传输连接
> 12. 窗口字段：2B。控制对方的发送数据量
> 13. 检验和字段：2B。
> 14. 紧急指针字段：2B。紧急数据的最后一个字节的序号
> 15. 选项字段：可变长度
> 16. 填充字段：为了使首部长度是4B整数倍

## 3.2、TCP连接管路

> *TCP连接的端点叫做套接字（socket）或插口*
>
> **三次握手**：全双工传输方式
>
> ​	目的：防止报文段在传输连接建立过程中出现差错
>
> ​    1.   第一次握手(SYN=1, seq=x):
>
>  	2. 第二次握手(SYN=1, ACK=1, seq=y, ACKnum=x+1):
>  	3. 第三次握手(ACK=1，ACKnum=y+1)

## 3.3、TCP可靠传输

>  **TCP数据编号与确认**：
>
>  ​	TCP每次发送的报文段的首部中的序号字段数值表示该报文段中的数据部分的第一个字节的序号
>
>  ​	TCP的确认是对接收到的数据的最高序号表示确认，确认号表示接收端**期望下次收到的数据中的第一个数据字节的序号**。
>
>  **TCP的重传机制**

## 3.4、TCP流量控制

> 利用滑动窗口机制可以很方便的在TCP连接上实现流量控制，以**字节**为单位

## 3.5、TCP拥塞控制的基本概念

> 产生拥塞：对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏
>
> 产生拥塞的条件：对资源需求的综合> 可用资源
>
> **拥塞控制与流量控制的性质对比**：
>
> 1. 拥塞控制唯一目的是使得网络能够承受仙有的网络负荷
> 2. 拥塞控制是一个全局性的过程，设计所有的主机、所有的路由器以及与降低网络传输性能有关的所有因素
> 3. 流量控制往往只在给定的发送端和接收端之间的点对点通信量的控制
> 4. 流量控制所要做的就是一直发送端发送数据的速率，以便使接收端来得及接收
> 5. 拥塞控制使很难设计的，因为他是一个动态的问题
> 6. 分组的丢失是发生拥塞的征兆而不是原因
> 7. 很多情况下是拥塞控制本身是发生死锁的原因

## 3.6、拥塞控制的四种算法

> **MSS**：最大报文段长度
>
> TCP发送端要求维护以下两个窗口：接收端窗口rwnd，拥塞窗口cwnd
>
> **发送窗口的上限值**：Min [rwnd,cwnd]
>
> *接收方总是有足够大的缓存空间，可以将发送窗口等同为拥塞窗口*
>
> **慢开始算法的原理**：
>
> 1. 刚开始设置cwnd=1
> 2. 每收到一个对新的报文确认cwnd+1，一个RTT（传输轮次）时间，cwnd会翻倍“指数增长”
>
> **拥塞避免算法的原理**：门限ssthresh
>
> ​		出现拥塞，ssthresh=1/2*ssthresh（ssthresh>=2），cwnd=1执行慢开始
>
> 1. cwnd<ssthresh，慢开始
> 2. cwnd>ssthresh，停止使用慢开始，用拥塞避免
> 3. cwnd=ssthresh，既可以使用慢开始也可以使用拥塞避免
>
> **快重传算法**：
>
> 1. 接受到一个失序的数据报文端后就立即发出重复确认
> 2. 发送端连续收到三个重复确认就重传对方未收到的数据
>
> **快恢复算法**：
>
> 1. 发送端收到连续三个重复的ACK时，ssthresh=1/2*ssthresh
> 2. cwnd=ssthresh
> 3. 若发送窗口还允许发送报文段，就按拥塞避免算法继续发送报文段

# 4、错题

> - TCP分组偏移字段：定长20+选项字段+填充=4B倍数，4B倍数/4——>二进制数
> - 
>
> 